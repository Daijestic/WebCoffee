<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- C√°c th·∫ª meta kh√°c -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/resetcss.css}">
    <link rel="stylesheet" th:href="@{/css/datdouong.css}">
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/chitietsanpham.css}">
    <link rel="icon" th:href="@{/image/Anh1.png}">
    <title>DND COFFEE</title>
    <!-- Slick Slider CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"/>

</head>
<body>
<div class="top-bar">
    GIAO H√ÄNG TO√ÄN QU·ªêC
</div>

<div class="header">
    <div class="menu-button" id="menu-toggle">
        <div class="menu-icon">‚ò∞</div>
        <div class="menu-text">MENU</div>
    </div>
    <a th:href = "@{/index}">
        <img th:src="@{/image/Anh1.png}" alt="DND Coffee" class="logo">
    </a>
    <div class="search-bar">
        <div class="search-form">
            <input type="text" class="search-input" placeholder="T√¨m s·∫£n ph·∫©m...">
            <button class="search-button">
                <span class="search-icon">‚åï</span>
            </button>
        </div>
    </div>

    <div class="user-actions">
        <a th:if="${tenNguoiDung == null}" th:href="@{/login}" style="text-decoration: none;">
            <div class="account">
                <div class="user-icon">üë§</div>
                <div>T√†i kho·∫£n</div>
            </div>
        </a>

        <div th:if="${tenNguoiDung != null}" class="dropdown">
            <div class="account">
                <div class="user-icon">üë§</div>
                <div th:text="${tenNguoiDung}">T√™n ng∆∞·ªùi d√πng</div>
            </div>
            <div class="dropdown-content">
                <a th:href="@{/ho-so}">H·ªì s∆° c√° nh√¢n</a>
                <a th:href="@{/don-mua}">ƒê∆°n mua</a>
                <a th:href="@{/logout}">ƒêƒÉng xu·∫•t</a>
            </div>
        </div>

        <div class="cart" id = "menu-cart">
            <div class="cart-icon">üõí</div>
            <div class="cart-count">0</div>
            <div>Gi·ªè h√†ng</div>
        </div>
    </div>
    <nav class="sidebar" id="sidebar">
        <div class="close-btn" id="close-menu">‚úñ</div>
        <ul class="menu">

            <li class="has-submenu">
                <a href="#">TRANG CH·ª¶</a>
                <ul class="submenu">
                    <li><a href="#">Trang ch·ªß</a></li>
                    <li><a href="../webbuy/xemtatca.html">FLASH DEAL</a></li>
                    <li><a href="#">T·∫æT 2025</a></li>
                </ul>
            </li>
            <li class="has-submenu">
                <a href="../webbuy/xemtatca.html">FLASH DEAL</a>
                <ul class="submenu">
                    <li><a href="../webbuy/xemtatca.html">FLASH DEAL</a></li>
                </ul>
            </li>
            <li><a href="#">MUA S·ªà</a></li>
            <li class="has-submenu">
                <a href="#">GI·ªöI THI·ªÜU</a>
                <ul class="submenu">
                    <li><a href="#">C√† Ph√™ Rang Xay</a></li>
                    <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                    <li><a href="#">Gi·ªõi thi·ªáu S·∫£n ph·∫©m DND Coffee¬Æ</a></li>
                </ul>
            </li>
            <li><a href="#">TIN T·ª®C</a></li>
        </ul>
    </nav>

    <nav class="cartbar" id="cartbar">
        <div class="close-btn" id="close-cart">‚úñ</div>
        <div class="cart-header">
            GI·ªé H√ÄNG
        </div>
        <div class="cart-items" id="cart-items">
            <div class="empty-cart" id="empty-cart">
                Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng
            </div>
            <!-- C√°c m·ª•c gi·ªè h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <div>T·ªïng ti·ªÅn:</div>
                <div class="cart-total-price" id="cart-total-price">0ƒë</div>
            </div>
            <a th:href="@{/thanhtoan}">
                <button class="checkout-btn" id="checkout-btn" disabled>Thanh to√°n</button>
            </a>
        </div>
    </nav>
</div>
    
    

    <div class="nav-bar">
        <a href="#" class="nav-item home-icon">üè†</a>
        <a href="#" class="nav-item active">TRANG CH·ª¶</a>
        <a href="#" class="nav-item">FLASH DEAL</a>
        <a href="#" class="nav-item">MUA S·ªà</a>
        <a href="#" class="nav-item">GI·ªöI THI·ªÜU</a>
        <a href="#" class="nav-item">TIN T·ª®C</a>
    </div>
    
    <div class="category-bar">
        <a href="#" class="category-item">C√† Ph√™ Rang Xay</a>
        <a href="#" class="category-item">C√† Ph√™ H·∫°t</a>
        <a href="#" class="category-item">C√† Ph√™ U·ªëng Li·ªÅn</a>
        <a href="#" class="category-item">C√† Ph√™ H√≤a Tan</a>
    </div>


    <div class="container">
        <div class="breadcrumb">
            <a href="#">Trang ch·ªß</a>
            <a href="#"  th:text="${mon.loaiMon}">FLASH DEAL</a>
            <p   th:text="${mon.tenMon}">DEAL TRI √ÇN - MUA 1 T·∫∂NG 1 - C√† ph√™ B·ªôt Truy·ªÅn Th·ªëng 1kg T·∫∑ng 1 g√≥i 200g</p>
        </div>
        
        <div class="product-container">
            <div class="product-images">
                <div class="main-image">
                    <img th:src="@{${mon.path}}" th:alt="${mon.tenMon}">
                </div>
            </div>
            
            <div class="product-info">
                <h1 class="product-title" th:text="${mon.tenMon}">DEAL TRI √ÇN - MUA 1 T·∫∂NG 1 - C√† ph√™ B·ªôt Truy·ªÅn Th·ªëng 1kg T·∫∑ng 1 g√≥i 200g</h1>
                
                <div class="product-meta">
                    <div class="product-brand">Th∆∞∆°ng hi·ªáu: DND Coffee</div>
                    <div class="product-sku"  th:text="|M√£ s·∫£n ph·∫©m: ${mon.idMon}|">M√£ s·∫£n ph·∫©m: PVN25</div>
                </div>

                <div class="size-selector" th:if="${mon.giaMonSizeResponses != null and !mon.giaMonSizeResponses.isEmpty()}">
                    <span class="size-selector-label">Size :</span>
                    <div class="size-options">
                        <div class="size-option"
                             th:each="size, iterStat : ${mon.giaMonSizeResponses}"
                             th:classappend="${iterStat.index == 0} ? 'selected' : ''"
                             th:data-id="${size.idSize}"
                             th:data-price="${size.giaBan}"
                             th:text="${size.tenSize}">
                        Size
                        </div>
                    </div>
                </div>
                
                <div class="quantity-selector">
                    <div class="quantity-btn decrease">-</div>
                    <input type="number" min="1" class="quantity-input" value="10">
                    <div class="quantity-btn increase">+</div>
                </div>
                
                <button class="add-to-cart">Th√™m v√†o gi·ªè</button>
                
                <button class="add-to-wishlist">
                    <span class="heart-icon">‚ô°</span>
                    Th√™m v√†o y√™u th√≠ch
                </button>
                
                <div class="product-sections">
                    <div class="section">
                        <div class="section-header">
                            <h3>M√î T·∫¢ S·∫¢N PH·∫®M</h3>
                            <span class="dropdown-icon">‚ñº</span>
                        </div>
                        <div class="section-content"  th:text="${mon.moTa}">
                            Th√¥ng tin chi ti·∫øt v·ªÅ s·∫£n ph·∫©m c√† ph√™ DND Coffee
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-header">
                            <h3>GIAO H√ÄNG TO√ÄN QU·ªêC</h3>
                            <span class="dropdown-icon">‚ñº</span>
                        </div>
                        <div class="section-content">
                            Th√¥ng tin v·ªÅ ch√≠nh s√°ch giao h√†ng
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-header">
                            <h3>H∆Ø·ªöNG D·∫™N B·∫¢O QU·∫¢N</h3>
                            <span class="dropdown-icon">‚ñº</span>
                        </div>
                        <div class="section-content">
                            Th√¥ng tin v·ªÅ c√°ch b·∫£o qu·∫£n s·∫£n ph·∫©m
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-header">
                            <h3>ƒê√ÅNH GI√Å</h3>
                            <span class="dropdown-icon">‚ñº</span>
                        </div>
                        <div class="section-content">
                            C√°c ƒë√°nh gi√° t·ª´ kh√°ch h√†ng v·ªÅ s·∫£n ph·∫©m
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Th√™m modal x√°c nh·∫≠n v√†o cu·ªëi trang -->
<div id="confirm-cart-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>X√°c nh·∫≠n th√™m v√†o gi·ªè h√†ng</h2>
        <div class="confirm-details">
            <div class="confirm-item">
                <span class="confirm-label">S·∫£n ph·∫©m:</span>
                <span class="confirm-value product-name" th:text="${mon.tenMon}"></span>
            </div>
            <div class="confirm-item">
                <span class="confirm-label">M√£ ng∆∞·ªùi d√πng:</span>
                <span class="confirm-value user-id" th:text="${user.id}"></span>
            </div>
            <div class="confirm-item">
                <span class="confirm-label">M√£ s·∫£n ph·∫©m:</span>
                <span class="confirm-value product-id" th:text="${mon.idMon}"></span>
            </div>
            <div class="confirm-item">
                <span class="confirm-label">Size:</span>
                <span class="confirm-value size-id"></span>
            </div>
            <div class="confirm-item">
                <span class="confirm-label">S·ªë l∆∞·ª£ng:</span>
                <span class="confirm-value quantity"></span>
            </div>
            <div class="confirm-item">
                <span class="confirm-label">Th√†nh ti·ªÅn:</span>
                <span class="confirm-value total-price"></span>
            </div>
        </div>
        <div class="modal-actions">
            <button class="cancel-btn">H·ªßy</button>
            <button class="confirm-btn">X√°c nh·∫≠n</button>
        </div>
    </div>
</div>
   
    <!-- Footer Section -->
<footer class="footer-container">
    <div class="footer-content">
      <!-- Company Info -->
      <div class="footer-column company-info">
        <h3 class="footer-heading">C√îNG TY TNHH DuongDai</h3>
        <p class="company-description">
          C√¥ng ty ph√¢n ph·ªëi h·ª£p l·ªá s·∫£n ph·∫©m c√† ph√™ th∆∞∆°ng hi·ªáu DND Coffee¬Æ.
        </p>
        <div class="certification">
          <img src="../image/logo_bct.webp" alt="B·ªô C√¥ng Th∆∞∆°ng certification" class="certification-image">
        </div>
      </div>
  
      <!-- Contact Info -->
      <div class="footer-column contact-info">
        <h3 class="footer-heading">TH√îNG TIN</h3>
        <p class="address">
          Tr·ª• s·ªü vƒÉn ph√≤ng: 17 Tr·∫ßn Ph√∫, H√† ƒê√¥ng, H√† N·ªôi
        <p class="phone">ƒêi·ªán tho·∫°i: 0365619789</p>
        <p class="email">Email: duongdaidnd@gmai;.com</p>
      </div>
  
      <!-- Customer Support -->
      <div class="footer-column customer-support">
        <h3 class="footer-heading">H·ªñ TR·ª¢ KH√ÅCH H√ÄNG</h3>
        <ul class="support-links">
          <li><a href="#">‚Ä¢ T√¨m ki·∫øm</a></li>
          <li><a href="#">‚Ä¢ Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
          <li><a href="#">‚Ä¢ Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
          <li><a href="#">‚Ä¢ Ch√≠nh s√°ch giao h√†ng</a></li>
          <li><a href="#">‚Ä¢ Li√™n h·ªá</a></li>
        </ul>
      </div>
  
      <!-- Customer Care -->
      <div class="footer-column customer-care">
        <h3 class="footer-heading">CHƒÇM S√ìC KH√ÅCH H√ÄNG</h3>
        <div class="phone-contact">
          <div class="phone-icon-container">
            <span class="phone-icon">üìû</span>
          </div>
          <div class="contact-numbers">
            <p class="bagged-coffee">C√† ph√™ ƒë√≥ng g√≥i: 091.756.1212</p>
            <p class="cafe-service">C√† ph√™ t·∫°i qu√°n: 1900.1755</p>
            <p class="email-contact">duongdaidnd.com</p>
          </div>
        </div>
        
        <div class="social-media">
          <h4 class="social-heading">FOLLOW US</h4>
          <div class="social-icons">
            <a href="#" class="social-link"><span class="social-icon">facebook</span></a>
            <a href="#" class="social-link"><span class="social-icon">twitter</span></a>
            <a href="#" class="social-link"><span class="social-icon">youtube</span></a>
            <a href="#" class="social-link"><span class="social-icon">instagram</span></a>
          </div>
        </div>
      </div>
    </div>
  </footer>
<script th:src="@{/js/muangay.js}"></script>
<script>
         // Simple toggle for section content
         document.querySelectorAll('.section-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
                header.querySelector('.dropdown-icon').textContent = content.style.display === 'block' ? '‚ñ≤' : '‚ñº';
            });
        });
         document.querySelectorAll('.size-option').forEach(option => {
             option.addEventListener('click', () => {
                 // B·ªè ch·ªçn t·∫•t c·∫£
                 document.querySelectorAll('.size-option').forEach(o => o.classList.remove('selected'));
                 // ƒê√°nh d·∫•u ch·ªçn
                 option.classList.add('selected');
                 // C·∫≠p nh·∫≠t gi√°
                 const price = option.getAttribute('data-price');
                 const formatted = Number(price).toLocaleString('vi-VN');
                 document.querySelector('.price-value').textContent = formatted + ' VNƒê';
             });
         });
    </script>
<script>
    // Th√™m ph·∫ßn n√†y v√†o file JavaScript c·ªßa b·∫°n ho·∫∑c th√™m tr·ª±c ti·∫øp v√†o file HTML trong th·∫ª <script>



    document.addEventListener('DOMContentLoaded', function() {
        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
        const addToCartButton = document.querySelector('.add-to-cart');
        const modal = document.getElementById('confirm-cart-modal');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelBtn = document.querySelector('.cancel-btn');
        const confirmBtn = document.querySelector('.confirm-btn');
        const quantityInput = document.querySelector('.quantity-input');
        const decreaseBtn = document.querySelector('.decrease');
        const increaseBtn = document.querySelector('.increase');
        const sizeOptions = document.querySelectorAll('.size-option');

        // Bi·∫øn l∆∞u tr·ªØ th√¥ng tin s·∫£n ph·∫©m
        let selectedSize = null;
        let selectedSizeId = null;
        let selectedPrice = 0;

        // Kh·ªüi t·∫°o gi√° tr·ªã m·∫∑c ƒë·ªãnh cho size (n·∫øu c√≥)
        if (sizeOptions.length > 0) {
            selectedSize = sizeOptions[0].textContent.trim();
            selectedSizeId = sizeOptions[0].getAttribute('data-id');
            selectedPrice = parseFloat(sizeOptions[0].getAttribute('data-price'));
        }

        // X·ª≠ l√Ω s·ª± ki·ªán khi ch·ªçn size
        sizeOptions.forEach(option => {
            option.addEventListener('click', function() {
                // B·ªè ch·ªçn t·∫•t c·∫£
                sizeOptions.forEach(opt => opt.classList.remove('selected'));
                // Ch·ªçn size hi·ªán t·∫°i
                this.classList.add('selected');
                // L∆∞u th√¥ng tin size ƒë∆∞·ª£c ch·ªçn
                selectedSize = this.textContent.trim();
                selectedSizeId = this.getAttribute('data-id');
                selectedPrice = parseFloat(this.getAttribute('data-price'));
            });
        });

        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t tƒÉng gi·∫£m s·ªë l∆∞·ª£ng
        decreaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }
        });

        increaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            quantityInput.value = currentValue + 1;
        });

        // X·ª≠ l√Ω s·ª± ki·ªán khi nh·∫•n n√∫t "Th√™m v√†o gi·ªè"
        addToCartButton.addEventListener('click', function() {
            // L·∫•y th√¥ng tin s·ªë l∆∞·ª£ng hi·ªán t·∫°i
            const quantity = parseInt(quantityInput.value);

            // C·∫≠p nh·∫≠t th√¥ng tin hi·ªÉn th·ªã trong modal
            document.querySelector('.size-id').textContent = selectedSize + ' (ID: ' + selectedSizeId + ')';
            document.querySelector('.quantity').textContent = quantity;

            // T√≠nh t·ªïng ti·ªÅn
            const totalPrice = quantity * selectedPrice;
            document.querySelector('.total-price').textContent = formatCurrency(totalPrice) + ' VNƒê';

            // Hi·ªÉn th·ªã modal
            modal.style.display = 'block';
        });

        // ƒê√≥ng modal khi nh·∫•n n√∫t ƒë√≥ng ho·∫∑c h·ªßy
        closeModalBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        cancelBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        // ƒê√≥ng modal khi click b√™n ngo√†i
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // X·ª≠ l√Ω khi nh·∫•n n√∫t x√°c nh·∫≠n
        confirmBtn.addEventListener('click', function() {
            // T·∫°o ƒë·ªëi t∆∞·ª£ng ch·ª©a th√¥ng tin s·∫£n ph·∫©m ƒë·ªÉ th√™m v√†o gi·ªè h√†ng
            const cartItem = {

                monId: document.querySelector('.product-id').textContent,
                sizeId: selectedSizeId,
                userId: document.querySelector('.user-id').textContent,
                soLuong: parseInt(quantityInput.value),
                ghiChu: document.getElementById('note')?.value || ''
            };

            // Th√™m v√†o gi·ªè h√†ng (ƒëo·∫°n n√†y c√≥ th·ªÉ thay b·∫±ng AJAX call ƒë·∫øn server)
            console.log('ƒê√£ th√™m v√†o gi·ªè h√†ng:', cartItem);

            // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
            alert('ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!');

            // ƒê√≥ng modal
            modal.style.display = 'none';
        });

        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }


        if (confirmBtn) {
            confirmBtn.addEventListener('click', function () {
                const monId = document.querySelector('.product-id').textContent.trim();
                const userId = document.querySelector('.user-id').textContent.trim();
                const sizeId = selectedSizeId;
                const soLuong = document.querySelector('.quantity').textContent.trim();
                const ghiChu = document.getElementById('note')?.value || '';

                // L·∫•y token CSRF t·ª´ cookie
                const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
                const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

                fetch('/api/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        [csrfHeader]: csrfToken  // Th√™m CSRF token v√†o header
                    },
                    credentials: 'include',  // G·ª≠i k√®m cookie ƒë·ªÉ Spring ƒë·ªçc token
                    body: JSON.stringify({
                        monId: parseInt(monId),
                        sizeId: parseInt(sizeId),
                        userId: parseInt(userId),
                        soLuong: parseInt(soLuong),
                        ghiChu: ghiChu
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.text().then(text => { throw new Error(text) });
                        }
                        return response.text();
                    })
                    .then(message => {
                        alert(message);
                        // C√≥ th·ªÉ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè h√†ng ·ªü ƒë√¢y
                    })
                    .catch(error => {
                        console.error('L·ªói:', error);
                        alert(error.message);
                    });
            });
        }
    });
    // Th√™m v√†o JavaScript ho·∫∑c s·ª≠ d·ª•ng Thymeleaf ƒë·ªÉ ki·ªÉm tra tr√™n m√°y ch·ªß
    const isAuthenticated = /*[[${#authentication.authenticated}]]*/ false;
    function checkLoginStatus() {
        // Ki·ªÉm tra th√¥ng qua m·ªôt endpoint API
        fetch('/api/auth/status', {
            method: 'GET',
            credentials: 'include'
        })
            .then(response => response.json())
            .then(data => {
                if (!data.authenticated) {
                    // Ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p, chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒëƒÉng nh·∫≠p
                    window.location.href = '/login?redirect=' + encodeURIComponent(window.location.href);
                }
            });
    }

    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
    function updateQuantity(monId, sizeId, change) {
        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        $.ajax({
            url: '/api/cart/update',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                monId: monId,
                sizeId: sizeId,
                soLuongThayDoi: change
            }),
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function(response) {
                // T·∫£i l·∫°i trang ƒë·ªÉ c·∫≠p nh·∫≠t gi·ªè h√†ng
                location.reload();
            },
            error: function(xhr) {
                alert('ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t gi·ªè h√†ng');
            }
        });
    }

    // X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng
    function removeFromCart(monId, sizeId) {
        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        $.ajax({
            url: '/api/cart/remove',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                monId: monId,
                sizeId: sizeId
            }),
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function(response) {
                // T·∫£i l·∫°i trang ƒë·ªÉ c·∫≠p nh·∫≠t gi·ªè h√†ng
                location.reload();
            },
            error: function(xhr) {
                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng');
            }
        });
    }

    // Ki·ªÉm tra khi nh·∫•n n√∫t "Th√™m v√†o gi·ªè h√†ng"
    document.querySelector('.confirm-btn').addEventListener('click', function(e) {
        e.preventDefault();
        checkLoginStatus();
        // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p, form s·∫Ω ƒë∆∞·ª£c submit
        if (isAuthenticated) {
            document.getElementById('confirm-cart-modal').submit();
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // T·∫£i th√¥ng tin gi·ªè h√†ng khi trang ƒë∆∞·ª£c load
        loadCartItems();

        // Th√™m s·ª± ki·ªán cho icon gi·ªè h√†ng
        document.getElementById('menu-cart').addEventListener('click', function() {
            document.getElementById('cartbar').classList.add('open');
        });

        // ƒê√≥ng gi·ªè h√†ng
        document.getElementById('close-cart').addEventListener('click', function() {
            document.getElementById('cartbar').classList.remove('open');
        });
    });

    function loadCartItems() {
        const token = document.querySelector('meta[name="_csrf"]').content;
        const header = document.querySelector('meta[name="_csrf_header"]').content;

        fetch('/api/cart', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                [header]: token
            }
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Kh√¥ng th·ªÉ t·∫£i gi·ªè h√†ng');
            })
            .then(data => {
                updateCartUI(data);
            })
            .catch(error => {
                console.error('L·ªói khi t·∫£i gi·ªè h√†ng:', error);
            });
    }

    function updateCartUI(cartItems) {
        const cartItemsContainer = document.getElementById('cart-items');
        const emptyCart = document.getElementById('empty-cart');
        const cartCount = document.querySelector('.cart-count');
        const checkoutBtn = document.getElementById('checkout-btn');

        // X√≥a n·ªôi dung hi·ªán t·∫°i
        cartItemsContainer.innerHTML = '';

        // Th√™m l·∫°i th√¥ng b√°o gi·ªè h√†ng tr·ªëng
        cartItemsContainer.appendChild(emptyCart);

        if (!cartItems || cartItems.length === 0) {
            emptyCart.style.display = 'block';
            cartCount.textContent = '0';
            checkoutBtn.disabled = true;
            document.getElementById('cart-total-price').textContent = '0ƒë';
            return;
        }

        // ·∫®n th√¥ng b√°o gi·ªè h√†ng tr·ªëng
        emptyCart.style.display = 'none';
        checkoutBtn.disabled = false;

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng s·∫£n ph·∫©m tr√™n icon gi·ªè h√†ng
        let totalItems = 0;
        let totalPrice = 0;

        cartItems.forEach(item => {
            totalItems += item.soLuong;
            totalPrice += item.giaBan * item.soLuong;

            const cartItemElement = document.createElement('div');
            cartItemElement.className = 'cart-item';
            cartItemElement.innerHTML = `
            <div class="cart-item-image">
                <img src="/images/${item.hinhAnh}" alt="${item.tenMon}">
            </div>
            <div class="cart-item-details">
                <div class="cart-item-name">${item.tenMon}</div>
                <div class="cart-item-size">Size: ${item.tenSize}</div>
                <div class="cart-item-price">${formatCurrency(item.giaBan)}ƒë</div>
                <div class="cart-item-quantity">
                    <button class="quantity-btn minus" onclick="updateCartQuantity(${item.idMon}, '${item.tenSize}', -1)">-</button>
                    <span class="quantity">${item.soLuong}</span>
                    <button class="quantity-btn plus" onclick="updateCartQuantity(${item.idMon}, '${item.tenSize}', 1)">+</button>
                </div>
                <button class="remove-btn" onclick="removeFromCart(${item.idMon}, '${item.tenSize}')">X√≥a</button>
            </div>
        `;

            cartItemsContainer.appendChild(cartItemElement);
        });

        cartCount.textContent = totalItems;
        document.getElementById('cart-total-price').textContent = formatCurrency(totalPrice) + 'ƒë';
    }

    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN').format(amount);
    }

    // C√°c h√†m c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng v√† x√≥a s·∫£n ph·∫©m c√≥ th·ªÉ th√™m sau
    function updateCartQuantity(idMon, tenSize, change) {
        const token = document.querySelector('meta[name="_csrf"]').content;
        const header = document.querySelector('meta[name="_csrf_header"]').content;

        fetch('/api/cart/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                [header]: token
            },
            body: JSON.stringify({
                idMon: idMon,
                tenSize: tenSize,
                soLuongThayDoi: change
            })
        })
            .then(response => {
                if (response.ok) {
                    loadCartItems(); // T·∫£i l·∫°i gi·ªè h√†ng sau khi c·∫≠p nh·∫≠t
                    return;
                }
                throw new Error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t gi·ªè h√†ng');
            })
            .catch(error => {
                console.error('L·ªói khi c·∫≠p nh·∫≠t gi·ªè h√†ng:', error);
            });
    }

    function removeFromCart(idMon, tenSize) {
        const token = document.querySelector('meta[name="_csrf"]').content;
        const header = document.querySelector('meta[name="_csrf_header"]').content;

        fetch('/api/cart/remove', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                [header]: token
            },
            body: JSON.stringify({
                idMon: idMon,
                tenSize: tenSize
            })
        })
            .then(response => {
                if (response.ok) {
                    loadCartItems(); // T·∫£i l·∫°i gi·ªè h√†ng sau khi x√≥a
                    return;
                }
                throw new Error('Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng');
            })
            .catch(error => {
                console.error('L·ªói khi x√≥a s·∫£n ph·∫©m:', error);
            });
    }
</script>
</body>

</html>