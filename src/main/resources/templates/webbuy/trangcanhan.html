<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/resetcss.css}">
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/datdouong.css}">
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/trangcanhan.css}">
    <link rel="icon" th:href="@{/image/Anh1.png}">
    <title>DND COFFEE - Trang c√° nh√¢n</title>
</head>
<body>
<div class="top-bar">
    GIAO H√ÄNG TO√ÄN QU·ªêC
</div>

<div class="header">
    <div class="menu-button" id="menu-toggle">
        <div class="menu-icon">‚ò∞</div>
        <div class="menu-text">MENU</div>
    </div>
    <a th:href="@{/index}">
        <img th:src="@{/image/Anh1.png}" alt="DND Coffee" class="logo">
    </a>
    <div class="search-bar">
        <div class="search-form">
            <input type="text" class="search-input" placeholder="T√¨m s·∫£n ph·∫©m...">
            <button class="search-button">
                <span class="search-icon">‚åï</span>
            </button>
        </div>
    </div>

    <div class="user-actions">
        <a th:if="${tenNguoiDung == null}" th:href="@{/login}" style="text-decoration: none;">
            <div class="account">
                <div class="user-icon">üë§</div>
                <div>T√†i kho·∫£n</div>
            </div>
        </a>

        <div th:if="${tenNguoiDung != null}" class="dropdown">
            <div class="account">
                <div class="user-icon">üë§</div>
                <div th:text="${tenNguoiDung}">T√™n ng∆∞·ªùi d√πng</div>
            </div>
            <div class="dropdown-content">
                <a th:href="@{/ho-so}">H·ªì s∆° c√° nh√¢n</a>
                <a th:href="@{/don-mua}">ƒê∆°n mua</a>
                <a th:href="@{/logout}">ƒêƒÉng xu·∫•t</a>
            </div>
        </div>
        <div class="cart" id="menu-cart">
            <div class="cart-icon">üõí</div>
            <div class="cart-count">0</div>
            <div>Gi·ªè h√†ng</div>
        </div>
    </div>
    <nav class="sidebar" id="sidebar">
        <div class="close-btn" id="close-menu">‚úñ</div>
        <ul class="menu">
            <li class="has-submenu">
                <a href="#">TRANG CH·ª¶</a>
                <ul class="submenu">
                    <li><a href="#">Trang ch·ªß</a></li>
                    <li><a href="../webbuy/xemtatca.html">FLASH DEAL</a></li>
                    <li><a href="#">T·∫æT 2025</a></li>
                </ul>
            </li>
            <li class="has-submenu">
                <a href="../webbuy/xemtatca.html">FLASH DEAL</a>
                <ul class="submenu">
                    <li><a href="../webbuy/xemtatca.html">FLASH DEAL</a></li>
                </ul>
            </li>
            <li><a href="#">MUA S·ªà</a></li>
            <li class="has-submenu">
                <a href="#">GI·ªöI THI·ªÜU</a>
                <ul class="submenu">
                    <li><a href="#">C√† Ph√™ Rang Xay</a></li>
                    <li><a href="#">Gi·ªõi thi·ªáu</a></li>
                    <li><a href="#">Gi·ªõi thi·ªáu S·∫£n ph·∫©m DND Coffee¬Æ</a></li>
                </ul>
            </li>
            <li><a href="#">TIN T·ª®C</a></li>
        </ul>
    </nav>

    <nav class="cartbar" id="cartbar">
        <div class="close-btn" id="close-cart">‚úñ</div>
        <div class="cart-header">
            GI·ªé H√ÄNG
        </div>
        <div class="cart-items" id="cart-items">
            <!-- C√°c s·∫£n ph·∫©m trong gi·ªè h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y qua JavaScript -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <div>T·ªïng ti·ªÅn:</div>
                <div class="cart-total-price">7.758.000ƒë</div>
            </div>
            <a th:href="@{/thanhtoan}">
                <button class="checkout-btn">Thanh to√°n</button>
            </a>
        </div>
    </nav>
</div>

<div class="container">
    <div class="sidebar">
        <div class="user-info">
            <div class="user-avatar" id="avatar-container">
                <img th:if="${user.avatar != null && !user.avatar.isEmpty()}" th:src="${user.avatar}" alt="Avatar" class="avatar-image">
                <span th:if="${user.avatar == null || user.avatar.isEmpty()}" class="avatar-placeholder">üë§</span>
                <div class="avatar-overlay" id="avatar-overlay">
                    <i class="fas fa-camera"></i>
                </div>
            </div>
            <div>
                <div class="username" th:text="${user.hoTen}">T√™n ng∆∞·ªùi d√πng</div>
                <div class="edit-profile">‚úèÔ∏è S·ª≠a H·ªì S∆°</div>
            </div>
        </div>

        <a href="#" class="menu-item active" data-tab="profile">
            <i class="fas fa-user icon"></i>
            T√†i Kho·∫£n C·ªßa T√¥i
        </a>
        <a href="#" class="menu-item" data-tab="password">
            <i class="fas fa-lock icon"></i>
            ƒê·ªïi M·∫≠t Kh·∫©u
        </a>
        <a href="#" class="menu-item" data-tab="orders">
            <i class="fas fa-shopping-bag icon"></i>
            ƒê∆°n Mua
        </a>
        <a href="#" class="menu-item">
            <i class="fas fa-ticket-alt icon"></i>
            Kho Voucher
        </a>
        <a href="#" class="menu-item">
            <i class="fas fa-coins icon"></i>
            ƒêi·ªÉm t√≠ch l≈©y
        </a>
    </div>

    <div class="main-content">
        <!-- Profile Tab -->
        <div id="profile-tab" class="content-tabs active">
            <h1>H·ªì S∆° C·ªßa T√¥i</h1>
            <div class="subtitle">Qu·∫£n l√Ω th√¥ng tin h·ªì s∆° ƒë·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n</div>

            <form th:action="@{/cap-nhat-ho-so}" method="post" id="profile-form">
                <input type="hidden" name="id" th:value="${user.id}">
                <table class="profile-form">
                    <tr>
                        <td>T√™n ƒëƒÉng nh·∫≠p</td>
                        <td>
                            <div th:if="${user != null}">
                                <span th:text="${user.hoTen}">T√™n ng∆∞·ªùi d√πng</span>
                            </div>

                            <input type="hidden" name="username" th:value="${user.username}" />
                        </td>
                    </tr>
                    <tr>
                        <td>H·ªç t√™n</td>
                        <td>
                            <input type="text" name="hoTen" th:value="${user.hoTen}" required />
                        </td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>
                            <input type="email" name="email" th:value="${user.email}" required />
                        </td>
                    </tr>
                    <tr>
                        <td>S·ªë ƒëi·ªán tho·∫°i</td>
                        <td>
                            <input type="tel" name="sdt" th:value="${user.sdt}" required />
                        </td>
                    </tr>
                    <tr>
                        <td>Gi·ªõi t√≠nh</td>
                        <td>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="gioiTinh" value="Nam" th:checked="${user.gioiTinh == 'Nam'}" /> Nam
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="gioiTinh" value="N·ªØ" th:checked="${user.gioiTinh == 'N·ªØ'}" /> N·ªØ
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="gioiTinh" value="Kh√°c" th:checked="${user.gioiTinh == 'Kh√°c'}" /> Kh√°c
                                </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>ƒê·ªãa ch·ªâ</td>
                        <td>
                            <input type="text" name="diaChi" th:value="${user.diaChi}" />
                        </td>
                    </tr>
                    <tr>
                        <td>ƒêi·ªÉm t√≠ch l≈©y</td>
                        <td>
                            <span th:text="${user.diemTichLuy}">0</span>
                            <input type="hidden" name="diemTichLuy" th:value="${user.diemTichLuy}" />
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit" class="save-btn">L∆∞u thay ƒë·ªïi</button>
                        </td>
                    </tr>
                </table>
                <!-- ƒê·∫£m b·∫£o g·ª≠i ƒë·ªß c√°c thu·ªôc t√≠nh c·ªßa UserRequest -->
                <input type="hidden" name="avatar" th:value="${user.avatar}" />
                <div th:if="${user.roles != null}">
                    <input type="hidden" name="roles" th:each="role : ${user.roles}" th:value="${role}" />
                </div>
            </form>
        </div>

        <!-- Password Change Tab -->
        <div id="password-tab" class="content-tabs">
            <h1>ƒê·ªïi M·∫≠t Kh·∫©u</h1>
            <div class="subtitle">ƒê·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n, vui l√≤ng kh√¥ng chia s·∫ª m·∫≠t kh·∫©u cho ng∆∞·ªùi kh√°c</div>

            <form th:action="@{/doi-mat-khau}" method="post" id="password-form">
                <input type="hidden" name="id" th:value="${user.id}">
                <input type="hidden" name="username" th:value="${user.username}">
                <table class="profile-form password-form">
                    <tr>
                        <td>M·∫≠t kh·∫©u hi·ªán t·∫°i</td>
                        <td>
                            <input type="password" name="currentPassword" required />
                        </td>
                    </tr>
                    <tr>
                        <td>M·∫≠t kh·∫©u m·ªõi</td>
                        <td>
                            <input type="password" name="newPassword" required minlength="8" />
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±</div>
                        </td>
                    </tr>
                    <tr>
                        <td>X√°c nh·∫≠n m·∫≠t kh·∫©u</td>
                        <td>
                            <input type="password" name="confirmPassword" required minlength="8" />
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit" class="save-btn">X√°c nh·∫≠n</button>
                        </td>
                    </tr>
                </table>
            </form>
        </div>

        <!-- Order History Tab -->
        <div id="orders-tab" class="content-tabs">
            <h1>ƒê∆°n Mua</h1>
            <div class="subtitle">Qu·∫£n l√Ω ƒë∆°n h√†ng c·ªßa b·∫°n</div>

            <div class="order-history" th:if="${not #lists.isEmpty(user.listHoaDon)}">
                <div class="order-card" th:each="hoaDon : ${user.listHoaDon}">
                    <div class="order-header">
                        <div class="order-date">
                            <span>ƒê∆°n h√†ng #</span>
                            <span th:text="${hoaDon.idHoaDon}">123456</span>
                            <span> - </span>
                            <span th:text="${#dates.format(hoaDon.ngayGioLapHoaDon, 'dd/MM/yyyy HH:mm')}">01/01/2025 10:30</span>
                        </div>
                        <div class="order-status"
                             th:class="${hoaDon.trangThai == 'Ho√†n th√†nh' ? 'order-status status-completed' :
                                       (hoaDon.trangThai == 'ƒêang x·ª≠ l√Ω' ? 'order-status status-pending' : 'order-status status-cancelled')}"
                             th:text="${hoaDon.trangThai}">
                            Ho√†n th√†nh
                        </div>
                    </div>
                    <div class="order-body">
                        <div class="order-items">
                            <div class="order-item" th:each="product : ${hoaDon.products}">
                                <div class="item-details">
                                    <div class="item-name" th:text="${product.tenMon}">C√† ph√™ ƒëen ƒë√°</div>
                                    <div class="item-metadata">
                                        <span th:if="${product.size != null}" th:text="'Size: ' + ${product.size}">Size: M</span>
                                        <span th:if="${product.ghiChu != null && !product.ghiChu.isEmpty()}" th:text="'Ghi ch√∫: ' + ${product.ghiChu}">Ghi ch√∫: √çt ƒë√°</span>
                                    </div>
                                </div>
                                <div class="item-quantity" th:text="'x' + ${product.soLuong}">x2</div>
                                <div class="item-price" th:text="${#numbers.formatDecimal(product.giaBan, 0, 'POINT', 0, 'COMMA')} + ' ƒë'">45.000 ƒë</div>
                            </div>
                        </div>
                    </div>
                    <div class="order-footer">
                        <div>
                            <span>Ph∆∞∆°ng th·ª©c thanh to√°n: </span>
                            <span th:text="${hoaDon.phuongThucThanhToan}">Ti·ªÅn m·∫∑t</span>
                        </div>
                        <div class="order-total">
                            <span>T·ªïng ti·ªÅn: </span>
                            <span class="order-total-amount" th:text="${#numbers.formatDecimal(hoaDon.tongTien, 0, 'POINT', 0, 'COMMA')} + ' ƒë'">90.000 ƒë</span>
                        </div>
                        <div th:if="${hoaDon.diemDaDung != null && hoaDon.diemDaDung > 0}">
                            <span>ƒêi·ªÉm ƒë√£ d√πng: </span>
                            <span th:text="${hoaDon.diemDaDung}">10</span>
                        </div>
                        <div th:if="${hoaDon.giamGia != null && hoaDon.giamGia > 0}">
                            <span>Gi·∫£m gi√°: </span>
                            <span th:text="${#numbers.formatDecimal(hoaDon.giamGia, 0, 'POINT', 0, 'COMMA')} + ' ƒë'">10.000 ƒë</span>
                        </div>
                        <div th:if="${hoaDon.phiShip != null && hoaDon.phiShip > 0}">
                            <span>Ph√≠ ship: </span>
                            <span th:text="${#numbers.formatDecimal(hoaDon.phiShip, 0, 'POINT', 0, 'COMMA')} + ' ƒë'">20.000 ƒë</span>
                        </div>
                        <div th:if="${hoaDon.hinhThuc != null && !hoaDon.hinhThuc.isEmpty()}">
                            <span>H√¨nh th·ª©c: </span>
                            <span th:text="${hoaDon.hinhThuc}">Giao h√†ng</span>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(user.listHoaDon)}" style="text-align: center; padding: 40px 0;">
                <div style="font-size: 24px; margin-bottom: 10px;">üòä</div>
                <div style="font-size: 18px; margin-bottom: 20px;">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</div>
                <a th:href="@{/index}" style="background-color: #bd9d3b; color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none;">
                    Mua s·∫Øm ngay
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Avatar Upload Modal -->
<div class="modal" id="avatar-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán</div>
            <div class="modal-close" id="close-modal">&times;</div>
        </div>
        <form th:action="@{/cap-nhat-avatar}" method="post" enctype="multipart/form-data" id="avatar-form">
            <input type="hidden" name="id" th:value="${user.id}">
            <input type="hidden" name="username" th:value="${user.username}">
            <div class="avatar-upload">
                <div class="avatar-preview" id="avatar-preview">
                    <img id="preview-image" th:src="${user.avatar != null && !user.avatar.isEmpty() ? user.avatar : '#'}" alt="Avatar Preview">
                    <div class="upload-placeholder" id="upload-placeholder">
                        K√©o th·∫£ ho·∫∑c nh·∫•p v√†o ƒë√¢y ƒë·ªÉ t·∫£i h√¨nh ·∫£nh
                    </div>
                </div>
                <input type="file" name="avatarFile" id="avatar-input" class="avatar-input" accept="image/*">
                <button type="button" class="upload-btn" id="trigger-upload">Ch·ªçn h√¨nh ·∫£nh</button>
                <button type="submit" class="confirm-btn">X√°c nh·∫≠n</button>
            </div>
        </form>
    </div>
</div>

<footer class="footer-container">
    <div class="footer-content">
        <div class="footer-column company-info">
            <h3 class="footer-heading">C√îNG TY TNHH MTV TH√ÅI KI√äN</h3>
            <p class="company-description">C√¥ng ty ph√¢n ph·ªëi h·ª£p l·ªá s·∫£n ph·∫©m c√† ph√™ th∆∞∆°ng hi·ªáu Highlands Coffee¬Æ.</p>
            <div class="certification">
                <img th:src="@{/image/certification-badge.png}" alt="B·ªô C√¥ng Th∆∞∆°ng certification" class="certification-image">
            </div>
        </div>

        <div class="footer-column contact-info">
            <h3 class="footer-heading">TH√îNG TIN</h3>
            <p class="address">Tr·ª• s·ªü vƒÉn ph√≤ng: 127 Nguy·ªÖn C∆° Th·∫°ch, An L·ª£i ƒê√¥ng, Q.2, Tp. H·ªì Ch√≠ Minh</p>
            <p class="phone">ƒêi·ªán tho·∫°i: 0917561212</p>
            <p class="email">Email: cpg.customerservice@vtijs.com</p>
        </div>

        <div class="footer-column customer-support">
            <h3 class="footer-heading">H·ªñ TR·ª¢ KH√ÅCH H√ÄNG</h3>
            <ul class="support-links">
                <li><a href="#">‚Ä¢ T√¨m ki·∫øm</a></li>
                <li><a href="#">‚Ä¢ Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                <li><a href="#">‚Ä¢ Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                <li><a href="#">‚Ä¢ Ch√≠nh s√°ch giao h√†ng</a></li>
                <li><a href="#">‚Ä¢ Li√™n h·ªá</a></li>
            </ul>
        </div>
    </div>
</footer>

<script th:src="@{/js/trangcanhan.js}"></script>
</body>
</html>